{% ckan_extends %}

{% set default_group_type = h.default_group_type('group') %}

{% block links -%}
  {{ super() }}
  <link rel="alternate" type="application/rdf+xml" href="{{ h.url_for('dataset.read', id=pkg.id, format='rdf', qualified=True) }}"/>
{% endblock -%}

{% block head_extras -%}
  {{ super() }}
  <meta property="og:title" content="{{ h.dataset_display_name(pkg) }} - {{ g.site_title }}">
  <meta property="og:description" content="{{ description|forceescape|trim }}">

  <meta name="twitter:card" content="summary" />
  <meta property="twitter:title" content="{{ h.dataset_display_name(pkg) }}">
  <meta name="twitter:image" content="{{ g.site_url }}/wp-content/themes/odpch-wp-theme/img/twitter_card.png" />
{% endblock -%}

{# Overridden from package/base.html #}}
{% block breadcrumb_content %}
  {% if pkg %}
    {% set dataset = h.dataset_display_name(pkg) %}
    {% if pkg.organization %}
      {% set organization = h.dataset_display_name(pkg.organization) %}
      {% set group_type = pkg.organization.type %}
      <li>{% link_for h.humanize_entity_type('organization', group_type, 'breadcrumb') or _('Organizations'), named_route=group_type ~ '.index' %}</li>
      <li>{% link_for organization|truncate(30), named_route=group_type ~ '.read', id=pkg.organization.name %}</li>
    {% else %}
      <li>{% link_for _(dataset_type.title()), named_route=dataset_type ~ '.search' %}</li>
    {% endif %}
    <li{{ self.breadcrumb_content_selected() }}>{% link_for dataset|truncate(30), named_route=pkg.type ~ '.read', id=pkg.name %}</li>
  {% else %}
    <li>{% link_for _(dataset_type.title()), named_route=dataset_type ~ '.search' %}</li>
    <li class="active"><a href="">{{ h.humanize_entity_type('package', dataset_type, 'create label') or _('Create Dataset') }}</a></li>
  {% endif %}
{% endblock %}

{% block content_primary_nav %}
  {{ h.build_nav_icon(dataset_type ~ '.read', _('Dataset'),  id=pkg.name, icon='sitemap') }}
  {# TODO: ACTIVITY_STREAMS #}
  {# {{ h.build_nav_icon('dataset.activity', _('Activity Stream'), id=pkg.name) }} #}

  {% if (h.admin_only and h.check_access('sysadmin')) or not h.admin_only %}
    {{ h.build_nav_icon(dataset_type ~ '.groups', h.humanize_entity_type('group', default_group_type, 'content tab') or _('Groups'), id=pkg.name, icon='users') }}
  {% endif %}

  {# {{ h.build_nav_icon('related_list', _('Related'), id=pkg.name) }} #}
{% endblock %}

{% block primary_content_inner %}
    {% block package_revision_info %}
      {% if revision_date %}
        <div class="module info alert alert-info">
          <p class="module-content">
            {% set timestamp = h.render_datetime(revision_date, with_hours=True) %}
            {% set url = h.url_for('dataset.read', id=pkg.name) %}

            {% trans timestamp=timestamp, url=url %}This is an old revision of this dataset, as edited at {{ timestamp }}. It may differ significantly from the <a href="{{ url }}">current revision</a>.{% endtrans %}
          </p>
        </div>
      {% endif %}
    {% endblock %}
{% endblock %}

{% block package_organization %}
  {% if pkg.organization %}
    {% set org = h.get_localized_org(pkg.owner_org) %}
    {% snippet "snippets/organization.html", organization=org, has_context_title=true %}
  {% endif %}
{% endblock %}

{% block package_license %}
{% endblock %}
